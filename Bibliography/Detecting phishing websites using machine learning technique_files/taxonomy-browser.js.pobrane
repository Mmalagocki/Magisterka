/*! For license information please see taxonomy-browser.js.LICENSE.txt */
!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e:e(jQuery)}((function(e){function l(l){var o,a=l||window.event,i=[].slice.call(arguments,1),s=0,r=0,c=0,u=0,v=0;return(l=e.event.fix(a)).type="mousewheel",a.wheelDelta&&(s=a.wheelDelta),a.detail&&(s=-1*a.detail),a.deltaY&&(s=c=-1*a.deltaY),a.deltaX&&(s=-1*(r=a.deltaX)),void 0!==a.wheelDeltaY&&(c=a.wheelDeltaY),void 0!==a.wheelDeltaX&&(r=-1*a.wheelDeltaX),u=Math.abs(s),(!t||t>u)&&(t=u),v=Math.max(Math.abs(c),Math.abs(r)),(!n||n>v)&&(n=v),o=s>0?"floor":"ceil",s=Math[o](s/t),r=Math[o](r/n),c=Math[o](c/n),i.unshift(l,s,r,c),(e.event.dispatch||e.event.handle).apply(this,i)}var t,n,o=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],a="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"];if(e.event.fixHooks)for(var i=o.length;i;)e.event.fixHooks[o[--i]]=e.event.mouseHooks;e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var e=a.length;e;)this.addEventListener(a[--e],l,!1);else this.onmousewheel=l},teardown:function(){if(this.removeEventListener)for(var e=a.length;e;)this.removeEventListener(a[--e],l,!1);else this.onmousewheel=null}},e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})})),function(e){!function(){var l=siteUrlPrefix+"taxonomy/",t={},n=[],o={},a={},i=null,s=null,r=!0,c=function(){r=!1};function u(i,r){r<=n.length-1&&function(l){for(;e(".levels .level").length>l;)e(".levels .level").last().remove(),n.pop()}(r);var c=function(i){return s=i,r=function(){for(var e=l+"?",t=1;t<n.length;t++)e+="c="+n[t]+"&";return e}(),"/"!=s&&(r+="c="+s),r=r.replace(/\s/g,"_"),e.ajax({url:r,type:"GET",dataType:"json",async:!1}).then((function(e,l,n){for(var i=[],r=0;r<e.length;r++){var c=e[r].subject.split("/"),u=c[c.length-1];i.push(u);var v=e[r].articleCount;o[u]=null!=v&&v>0?v:0;var h=e[r].childCount;a[u]=null!=h&&h>0?h:0,t[u]=[]}t[s]=i.sort()}),(function(l,t,n){e(".subject-area").unbind("click",M).attr("title","Error: No subject terms available!").addClass("disabled"),e("subject-area").on("click",(function(e){return e.preventDefault(),!1}))})),void 0!==t[i]?t[i]:[];var s,r}(i);n.push(i),function(l,t){!function(l,t){"/"===l&&(l="ROOT");var i,s=function(l){var t=e.map(l.items,(function(e,t){return["<li>",'<a href="'+e.link+'"'+(e.isLeaf?' class="no-children"':"")+' data-level="'+l.level+'">',e.name+" "+(e.isLeaf?"("+e.count+")":""),"</a>","</li>"].join("\n")})),n=l.parent_term;"ROOT"===n&&(n="All Subject Areas");var o=['<div class="level" data-level="'+l.level+'">','<div class="level-title">'+n+"</div>",'<div class="level-top">','<a href="'+l.view_all_link+'">View All Articles ('+l.view_all_total+")</a>","</div>",'<a href="#" class="up"></a>','<div class="level-scroll">',"<ul>",t.join("\n"),"</ul>","</div>",'<a href="#" class="down"></a>'];return l.items.length<5&&(o[5]='<a href="#" class="up hide-active-scroll"></a>',o[11]='<a href="#" class="down hide-active-scroll"></a>'),o.push(["</div>"]),o.join("\n")}({parent_term:l,items:(i=t,e.map(i,(function(e){if("ROOT"!==e)return{name:e,isLeaf:0===a[e],link:g(e),count:o[e]}}))),level:n.length,view_all_link:g(l),view_all_total:o[l]});e(".levels-position").append(s),b(e(".level").last())}(l,t);var i=e(".levels-position .level").length,r=e(".levels-position").position().left,c=i-3-Math.abs(r/s);c>0&&m("-="+s*c)}(i,c)}function v(l){var t=e(l.target);if(t.hasClass("no-children"))return!0;l.preventDefault();var n,o=t.data("level");u((n=t,e.trim(n.html().replace(/\([0-9]+\)/g,""))),o),t.closest(".level").find("li").removeClass("active"),t.closest("li").addClass("active")}function h(l){l.preventDefault();var t=e(l.target);if(!t.hasClass("active")||e(".levels-position").is(":animated"))return!1;m((t.hasClass("next")?"-=":"+=")+e(".level").outerWidth(!0)),e(":focus").blur()}function d(l){l.preventDefault(),cancelClick=setTimeout(c,100);var t=e(l.target),n=t.siblings(".level-scroll"),o=n.children("ul").height(),a=n.scrollTop(),i=800,s=t.hasClass("up")?a:o-a;i=Math.round(s*i/o),n.animate({scrollTop:t.hasClass("up")?0:o},i)}function f(l){l.preventDefault();var t=e(l.target),n=t.siblings(".level-scroll");if(clearTimeout(cancelClick),n.stop(),r){var o=n.scrollTop();n.animate({scrollTop:t.hasClass("up")?o-100:o+100},300)}r=!0}function p(l,t,n,o){l.preventDefault();var a=10*Math[o<0?"floor":"ceil"](o/60),i=e(this).scrollTop();e(this).scrollTop(i-a)}function m(l){e(".levels-position").stop().animate({left:l},200,w)}function w(){var l=Math.round(e(".levels-position").position().left),t=e(".levels-position .level").length,n=Math.abs(l/s),o=t-3-n,a=e(".prev"),i=e(".next");n>0?a.show().addClass("active"):a.hide().removeClass("active"),o>0?i.show().addClass("active"):i.hide().removeClass("active")}function b(e){clearTimeout(null),null!==i&&i.data("level")!==e.data("level")&&function(e,l){clearTimeout(null),e.removeClass("level-active-over");var t=e.data("level")<=n.length,o=l&&l.data("level")<e.data("level");(t||o)&&(e.removeClass("level-active"),e.addClass("level-selection")),i=null}(i,e),e.removeClass("level-selection"),e.addClass("level-active level-active-over"),i=e}function g(l){var t=e("#taxonomy-browser").attr("data-search-url")+"/";return void 0!==l&&"ROOT"!==l&&(l=""+l,t+=encodeURIComponent(l.replace(new RegExp("\\s","g"),"_").toLowerCase())),t}function C(e){if(!($tb.queue().length>0)){e=e||!1;var l=$tb.is(":hidden");e||!l?l||$tb.slideUp():$tb.slideDown()}}function M(e){e.preventDefault(),e.stopPropagation(),C()}function x(l){u("/",0),s=Math.round(e(".levels-position .level").outerWidth(!0))}e(document).ready((function(){$tb=e("#taxonomy-browser"),function(){e(".level-active").hover((function(){e(this).addClass("level-active-over")}),(function(){e(this).removeClass("level-active-over")})),e(".subject-area").one("click",x),e(".subject-area").on("click",M),e(document).bind("click",(function(e){C(!0)})),$tb.click((function(e){e.stopPropagation()}));var l=e(".levels-position");"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch||(l.on("mouseenter",".level",(function(l){b(e(l.currentTarget))})),l.on("mousedown",".level > a",d),l.on("mouseup",".level > a",f)),l.on("mousewheel",".level-scroll",p),l.on("click",".level > a",(function(e){e.preventDefault()})),l.on("click","ul li a",v),e("#taxonomy-browser").find(".prev, .next").click(h)}()}))}()}(jQuery);